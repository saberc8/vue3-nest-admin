var E=Object.defineProperty;var C=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var S=(e,s,o)=>s in e?E(e,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[s]=o,k=(e,s)=>{for(var o in s||(s={}))K.call(s,o)&&S(e,o,s[o]);if(C)for(var o of C(s))V.call(s,o)&&S(e,o,s[o]);return e};var v=(e,s,o)=>new Promise((i,m)=>{var R=t=>{try{l(o.next(t))}catch(n){m(n)}},d=t=>{try{l(o.throw(t))}catch(n){m(n)}},l=t=>t.done?i(t.value):Promise.resolve(t.value).then(R,d);l((o=o.apply(e,s)).next())});import{r as h,f as p,u as a,d as q,g as Q,h as W,a as _,j,v as $,o as H,k as J,w as u,e as c,i as X,l as b,m as Y,n as T,p as Z,q as M,_ as ee}from"./index-7b1c4b91.js";var P=(e=>(e[e.LOGIN=0]="LOGIN",e[e.REGISTER=1]="REGISTER",e[e.RESET_PASSWORD=2]="RESET_PASSWORD",e[e.MOBILE=3]="MOBILE",e[e.QR_CODE=4]="QR_CODE",e))(P||{});const x=h(0);function oe(){function e(i){x.value=i}const s=p(()=>x.value);function o(){e(0)}return{setLoginState:e,getLoginState:s,handleBackLogin:o}}function se(e){function s(){return v(this,null,function*(){const o=a(e);return o?yield o.validate():void 0})}return{validForm:s}}function ae(e){const s=p(()=>F("请输入账号")),o=p(()=>F("请输入密码")),i=p(()=>F("请输入验证码")),m=p(()=>F("请输入手机号"));return{getFormRules:p(()=>{const d=a(s),l=a(o),t=a(i),n=a(m),g={sms:t,mobile:n};switch(a(x)){case 1:return k({account:d,password:l,confirmPassword:[{validator:validateConfirmPassword(e==null?void 0:e.password),trigger:"change"}],policy:[{validator:validatePolicy,trigger:"change"}]},g);case 2:return k({account:d},g);case 3:return g;default:return{account:d,password:l}}})}}function F(e){return[{required:!0,message:e,trigger:"change"}]}const te=q({__name:"LoginForm",setup(e){const{notification:s,createMessage:o}=M(),i=Q(),{getLoginState:m}=oe(),{getFormRules:R}=ae(),d=h(),l=h(!1),t=h(!1),n=W({account:"admin",password:"123456"}),{validForm:g}=se(d),z=p(()=>a(m)===P.LOGIN);function I(){return v(this,null,function*(){const f=yield g();if(f)try{l.value=!0;const r=yield i.login({password:f.password,username:f.account});r&&s.success({message:"登录成功",description:`用户名: ${r.nickname}`,duration:3})}catch(r){}finally{l.value=!1}})}function B(){return v(this,null,function*(){const{createConfirm:f}=M();f({iconType:"warning",title:()=>T("span","温馨提醒"),content:()=>T("span","确定要初始化数据库吗？"),onOk:()=>v(this,null,function*(){yield Z(),o.success("初始化成功")})})})}return(f,r)=>{const G=_("a-input"),y=_("a-form-item"),L=_("a-input-password"),N=_("a-checkbox"),D=_("a-col"),U=_("a-row"),O=_("a-button"),A=_("a-form");return j((H(),J(A,{class:"login-form",model:a(n),rules:a(R),ref_key:"formRef",ref:d,onKeypress:Y(I,["enter"])},{default:u(()=>[c(y,{name:"account",class:"enter-x"},{default:u(()=>[c(G,{size:"large",value:a(n).account,"onUpdate:value":r[0]||(r[0]=w=>a(n).account=w),placeholder:"账号",class:"fix-auto-fill"},null,8,["value"])]),_:1}),c(y,{name:"password",class:"enter-x"},{default:u(()=>[c(L,{size:"large",visibilityToggle:"",value:a(n).password,"onUpdate:value":r[1]||(r[1]=w=>a(n).password=w),placeholder:"密码"},null,8,["value"])]),_:1}),c(U,{class:"enter-x"},{default:u(()=>[c(D,{span:12},{default:u(()=>[c(y,null,{default:u(()=>[c(N,{checked:a(t),"onUpdate:checked":r[2]||(r[2]=w=>X(t)?t.value=w:null),size:"small"},{default:u(()=>[b(" 记住我 ")]),_:1},8,["checked"])]),_:1})]),_:1})]),_:1}),c(y,{class:"enter-x"},{default:u(()=>[c(O,{type:"primary",size:"large",block:"",onClick:I,loading:a(l)},{default:u(()=>[b(" 登录 ")]),_:1},8,["loading"]),c(O,{type:"danger",size:"large",block:"",onClick:B,style:{"margin-top":"20px"}},{default:u(()=>[b(" 数据库初始化 ")]),_:1})]),_:1})]),_:1},8,["model","rules","onKeypress"])),[[$,a(z)]])}}});const ce=ee(te,[["__scopeId","data-v-811a6e23"]]);export{ce as default};
